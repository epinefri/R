---
title: "Fitness tracker case study in R"
author: "Daniela"
date: "2022-10-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Bellabeat is a company that manufactures health-focused smart devices. The objective of the case study is to analyze smart device data to gain insight into how consumers are using their smart devices. The insights will then help guide the marketing strategy for the company.

#### Starting points:

-   Investigating data from products with similar functionality
-   Identify usage trends
-   Help Bellabeat identify potential weaknesses and inspire ideas on new functions or products

## Data sources

-   FitBit Fitness Tracker Data
    -   The dataset was downloaded from Kaggle (made available by [Mobius](https://www.kaggle.com/arashnic))
    -   The dataset is under CC0: Public Domain licence
    -   The data contains the personal fitness tracker data of thirty Fitbit users.
    -   Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users' habits.
    -   The datasets were generated by collecting the responses to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016.
    -   The dataset consists of 18 .csv files.
        -   note: MET is the metabolic equivalent of task or simply metabolic equivalent. It is a physiological measure expressing the energy cost (or calories) of physical activities. While exercising, the MET equivalent is the energy expended compared to rest, so MET values indicate the intensity.

## Data processing

#### Libraries

```{r}
library(tidyverse)
library(lubridate)
library(ggplot2)
```

#### Upload data

Selected 4 out of 18 csv files:

```{r}
dailyActivity <- read_csv("data/selected/dailyActivity.csv", show_col_types = FALSE)

heartrate_seconds <- read_csv("data/selected/heartrate_seconds.csv", show_col_types = FALSE)

sleepDay <- read_csv("data/selected/sleepDay.csv", show_col_types = FALSE)

weightLogInfo <- read_csv("data/selected/weightLogInfo.csv", show_col_types = FALSE)

hrCalories <- read_csv("data/selected/hourlyCalories_merged.csv", show_col_types = FALSE)

hrIntensity <- read_csv("data/selected/hourlyIntensities_merged.csv", show_col_types = FALSE)

hrSteps <- read_csv("data/selected/hourlySteps_merged.csv", show_col_types = FALSE)
```

Preview:

```{r}
colnames(dailyActivity)
```

```{r}
colnames(heartrate_seconds)
```

```{r}
colnames(sleepDay)
```

```{r}
colnames(weightLogInfo)
```
 

### Data cleaning

Check the number of submitted values from SleepDay table
```{r}
table(sleepDay$"Id")
```
15 out of 24 individuals have more than 10 recorded days; 
Create a new table to only use data from those 15 users:

```{r}
# create a table containing only ids of users with more than 10 entries

SleepSummaryIds <- sleepDay %>% 
  group_by(Id) %>% 
  count(unique("Id"), sort = TRUE) %>% 
  filter(n > 10)

as_tibble(SleepSummaryIds)
```

Join the ids table with the sleepDay table:
```{r}
SleepFiltered <- sleepDay %>% right_join(SleepSummaryIds, by="Id")
as_tibble(SleepFiltered)
  
```

Check the weightLogInfo number of inputs:
```{r}
table(weightLogInfo$Id)
```
  * Only 8 users submitted weight data, and only 2 of them have more than 5 entries.
  
Add a Date column to SleepFiltered and dailyActivity
```{r}
# SleepFiltered
SleepFiltered$SleepDay <- mdy_hms(SleepFiltered$SleepDay)
SleepFiltered$Date <- as_date(SleepFiltered$SleepDay)

# dailyActivity
dailyActivity$ActivityDate <- mdy(dailyActivity$ActivityDate)
dailyActivity$Date <- as_date(dailyActivity$ActivityDate)

```

Add a hour column to hrIntensity, hrCalories, hrSteps
```{r}
# hrIntensity
hrIntensity$ActivityHour <- mdy_hms(hrIntensity$ActivityHour) 
hrIntensity$Hour <- hms::as_hms(hrIntensity$ActivityHour)

# hrCalories
hrCalories$ActivityHour <- mdy_hms(hrCalories$ActivityHour) 
hrCalories$Hour <- hms::as_hms(hrCalories$ActivityHour)

# hrSteps
hrSteps$ActivityHour <- mdy_hms(hrSteps$ActivityHour) 
hrSteps$Hour <- hms::as_hms(hrSteps$ActivityHour)

```

  
## Data analysis

Created a new data frame to summarize average values for each Id:

* Activity Summary: mean total steps, distance, sedentary minutes and calories for each Id
```{r}
ActivitySummary <- dailyActivity %>% 
  group_by(Id) %>% 
  summarize(meanTotalSteps = mean(TotalSteps),
            meanTotalDistance = mean(TotalDistance),
            meanSedentaryMinutes = mean(SedentaryMinutes),
            meanCalories = mean(Calories))
```

* Heart rate summary: mean, min, max, median value of heart rate
```{r}
HeartrateSummary <- heartrate_seconds %>% 
  group_by(Id) %>% 
  summarize(meanBPM = mean(Value),
            minBPM = min(Value),
            maxBPM = max(Value),
            medBPM = median(Value))
```

* Sleep summary: average minutes of sleep, average time spent in bed
```{r}
SleepSummary <- SleepFiltered %>% 
  group_by(Id) %>% 
  summarize(meanSleepTime = mean(TotalMinutesAsleep),
            meanTimeInBed = mean(TotalTimeInBed))
```

*Weight summary: average weight, BMI
```{r}
WeightSummary <- weightLogInfo %>% 
  group_by(Id) %>% 
  summarize(meanWeightKg = mean(WeightKg),
            meanBMI = mean(BMI))
```

Merge tables, resulting in a table that summarizes data for each person.
```{r}
Summary <- ActivitySummary %>% 
  left_join(HeartrateSummary, by = "Id") %>% 
  left_join(SleepSummary, by = "Id") %>% 
  left_join(WeightSummary, by = "Id")

as_tibble(Summary)
```

Remove unnecessary columns 
```{r}
remove(ActivitySummary);
remove(HeartrateSummary);
remove(SleepSummary); 
remove(SleepSummaryIds); 
remove(WeightSummary);
```


* Observations:
  * Activity data was collected for 33 individual ids (although the number of participants is said to be thirty)
  * Heart rate data was collected for 14 individuals
  * Sleep data was collected for 24 individuals, of which 15 were selected for analysis (having more than 10 unique entries)
  * Weight data was collected for 8 individuals. Not enough entries per individual to analyse weight loss or BMI changes. Also, the table contains only two entries of fat percentage, insufficient for analysis

  
## Visualization

```{r}
dailyActivity %>% 
  ggplot(mapping = aes(x = TotalSteps, y = Calories)) + geom_point() + geom_smooth(method=lm, se=FALSE) + labs(title = "Total number of steps and calories burned", subtitle = "The more steps a person takes, the more calories they burn.", x = "Total steps")
```


```{r}
hrCalories %>% 
  inner_join(hrIntensity, by = c("Id", "ActivityHour")) %>% 
  ggplot(mapping = aes(x = AverageIntensity, y = Calories)) + geom_point() + geom_smooth(method=lm, se=FALSE) + labs(title = "The average activity intensity and calories", subtitle = "Higher activity levels corelate with more calories burnt. Most users have a low activity level.", x = "Average intensity")
```


```{r}
dailyActivity %>% inner_join(SleepFiltered, by = c("Id", "Date")) %>% 
  ggplot(mapping = aes(x = SedentaryMinutes, y = TotalMinutesAsleep)) + geom_point() + geom_smooth(method=lm, se=FALSE) + labs(title = "Sedentary time and duration of sleep", subtitle = "Sedentarism negatively impacts the quantity of sleep.", x = "Total sedentary minutes", y = "Total minutes asleep")
```


```{r}
hrIntensity %>% 
  ggplot(mapping = aes(x = Hour, y = AverageIntensity)) + geom_bar(stat='identity') + labs(title = "Activity intensity by the hour", y = "Average activity intensity")
```












